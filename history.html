<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>History ‚Äî StockTone</title>
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <div class="brand-badge">üïò</div>
        <div>
          <div class="site-title">StockTone</div>
          <div class="site-sub">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ / ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å</div>
        </div>
      </div>
      <div class="header-actions">
        <input id="qSku" class="input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å SKU ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á (optional)">
        <button id="btnLoad" class="btn">‡πÇ‡∏´‡∏•‡∏î</button>
      </div>
    </div>

    <nav class="nav-bar">
      <div class="container nav-inner">
        <button class="nav-btn" onclick="location.href='catalog.html'">Catalog</button>
        <button class="nav-btn active">History</button>
        <button class="nav-btn" onclick="location.href='admin.html'">Admin</button>
      </div>
    </nav>
  </header>

  <main class="container" style="margin-top:18px">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
        <div class="muted">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>
      </div>
      <div id="histList" style="min-height:120px">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
  </main>

  <footer class="site-footer container">StockTone ‚Äî history</footer>

  <script>
    async function apiGet(p){
      if(typeof APPS_SCRIPT_URL === 'undefined' || !APPS_SCRIPT_URL) throw new Error('APPS_SCRIPT_URL not set');
      const url = APPS_SCRIPT_URL + '?' + new URLSearchParams(p).toString();
      const r = await fetch(url);
      return r.json();
    }

    function renderHistory(rows){
      const wrap = document.getElementById('histList');
      wrap.innerHTML = '';
      if(!rows || rows.length === 0){ wrap.innerHTML = '<div class="empty">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>'; return; }
      const ul = document.createElement('ul'); ul.style.paddingLeft='18px';
      rows.forEach(r => {
        const li = document.createElement('li');
        li.style.marginBottom='10px';
        const t = document.createElement('div');
        t.innerHTML = `<strong>${r.action || r.actionType || ''}</strong> ‚Äî SKU: <em>${r.sku || ''}</em> | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${r.qty||r[2]||0} | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${r.note||r[4]||''} <div class="muted small">${r[0] || r.timestamp || ''} ‚Äî by ${r.admin || r[5] || ''}</div>`;
        li.appendChild(t);
        ul.appendChild(li);
      });
      wrap.appendChild(ul);
    }

    async function loadHistory(){
      try{
        document.getElementById('histList').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
        const sku = document.getElementById('qSku').value.trim();
        const params = { action:'history_list', limit:200 };
        if(sku) params.sku = sku;
        const res = await apiGet(params);
        if(!res || !res.ok) { document.getElementById('histList').textContent = '‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'; return; }
        renderHistory(res.data || []);
      }catch(err){
        console.error(err);
        document.getElementById('histList').textContent = '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
      }
    }

    document.getElementById('btnLoad').addEventListener('click', loadHistory);
    document.addEventListener('DOMContentLoaded', loadHistory);
  </script>
</body>
</html>
